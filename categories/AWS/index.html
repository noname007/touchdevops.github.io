<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="Cloud &amp; DevOps" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>AWS - Cloud &amp; DevOps</title><link rel="stylesheet" href="/css/main.css" type="text/css">
<!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">Cloud &amp; DevOps</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><span class="post__time">黄博文</span><span class="post__time"> @ </span><time datetime="2015-01-17T15:23:15.000Z" class="post__time">January 17, 2015</time><h1 class="post__title"><a href="/2015/01/17/create-nat-node-in-aws/">在AWS中创建NAT节点</a></h1></header><div class="post__main echo"><p>NAT, Network Address Translation,即网络地址转换。当内部网络的主机想要访问外网，但是又不想直接暴露给公网，可以通过NAT节点来访问外网。这样做有两个好处，第一是内网的主机无需拥有公网IP就可访问网络（NAT节点需要公网IP），节约了公网IP；第二是内网的主机由于没有公网IP，所以公网的电脑无法访问到它，这样就可以隐藏自己。一个很经典的示例是假如你有一台数据库服务器放置在内网中，为在同一个内网中的web服务器提供数据服务，为了安全性考虑你不会把它直接暴露在公网中。但是数据库服务器有时候自己是需要访问公网的，比如需要升级数据库服务器中的某些软件等。采用NAT方案可以很好的解决这个问题。</p>
<a id="more"></a>
<p>下图是NAT节点的功能示意图。</p>
<img src="/images/natnode.png">


<p>一些路由器或者装有特定软件的主机都可以作为NAT节点。在AWS中如果你想创建一个NAT节点的话那是非常的方便，因为AWS直接提供了预装了NAT软件的AMI，你只需直接使用该AMI在你的公共子网中实例化一台机器，并进行相应的配置即可。</p>
<p>下面的图展示了在AWS中的一个经典的VPC架构。该VPC里面建立了两个子网，一个是公共子网，通过Intenet Geteway和公网连接；一个是私有子网，无法直接访问公网。然后在公共子网中建立了一个EC2机器，使用的是AWS提供的具有NAT功能的AMI，并为它分配了一个弹性IP，这样该EC2就是一个NAT节点。在私有子网的所有机器都具有了通过该NAT节点访问外网的能力。</p>
<img src="/images/vpcandnat.png">

<p>为了创建这样一套网络及机器，最简便的方式当然是使用AWS提供的CloudFormation了。如果不了解CloudFormation，可以看我以前写过的一篇文章 <a href="http://www.huangbowen.net/blog/2013/10/23/aws-cloudformation/" target="_blank" rel="external">《亚马逊云服务之CloudFormation》</a>。下面展示的是创建该整个VPC的CloudFormation脚本。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">{</div><div class="line">  "<span class="attribute">AWSTemplateFormatVersion</span>": <span class="value"><span class="string">"2010-09-09"</span></span>,</div><div class="line">  "<span class="attribute">Description</span>": <span class="value"><span class="string">"Setup a vpc, which contains two subnets and one NAT machine"</span></span>,</div><div class="line">  "<span class="attribute">Parameters</span>": <span class="value">{</span></div><div class="line">    "<span class="attribute">KeyName</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"Name of and existing EC2 KeyPair to enable SSH access to the instance"</span></span>,</div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"String"</span></span></div><div class="line">    },</div><div class="line">    "<span class="attribute">VpcCidr</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"CIDR address for the VPC to be created."</span></span>,</div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"String"</span></span>,</div><div class="line">      "<span class="attribute">Default</span>": <span class="value"><span class="string">"10.2.0.0/16"</span></span></div><div class="line">    },</div><div class="line">    "<span class="attribute">AnyCidr</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"CIDR address for Any Where."</span></span>,</div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"String"</span></span>,</div><div class="line">      "<span class="attribute">Default</span>": <span class="value"><span class="string">"0.0.0.0/0"</span></span></div><div class="line">    },</div><div class="line">    "<span class="attribute">AvailabilityZone1</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"First AZ."</span></span>,</div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"String"</span></span>,</div><div class="line">      "<span class="attribute">Default</span>": <span class="value"><span class="string">"cn-north-1a"</span></span></div><div class="line">    },</div><div class="line">    "<span class="attribute">PublicSubnetCidr</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"Address range for a public subnet to be created in AZ1."</span></span>,</div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"String"</span></span>,</div><div class="line">      "<span class="attribute">Default</span>": <span class="value"><span class="string">"10.2.1.0/24"</span></span></div><div class="line">    },</div><div class="line">    "<span class="attribute">PrivateSubnetCidr</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"Address range for private subnet."</span></span>,</div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"String"</span></span>,</div><div class="line">      "<span class="attribute">Default</span>": <span class="value"><span class="string">"10.2.2.0/24"</span></span></div><div class="line">    },</div><div class="line">    "<span class="attribute">NATInstanceType</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"Instance type for NAT"</span></span>,</div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"String"</span></span>,</div><div class="line">      "<span class="attribute">Default</span>": <span class="value"><span class="string">"t1.micro"</span></span></div><div class="line">    }</div><div class="line">  },</div><div class="line">  "<span class="attribute">Mappings</span>": <span class="value">{</span></div><div class="line">    "<span class="attribute">AWSNATAMI</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">cn-north-1</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">AMI</span>": <span class="value"><span class="string">"ami-eab220d3"</span></span></div><div class="line">      }</div><div class="line">    }</div><div class="line">  },</div><div class="line">  "<span class="attribute">Resources</span>": <span class="value">{</span></div><div class="line">    "<span class="attribute">VPC</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::VPC"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">CidrBlock</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VpcCidr"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">          }</div><div class="line">        ]</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">InternetGateWay</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::InternetGateway"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"INTERNET_GATEWAY"</span></span></div><div class="line">          }</div><div class="line">        ]</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">GatewayToInternet</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::VPCGatewayAttachment"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">InternetGatewayId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"InternetGateWay"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">VpcId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PublicSubnet</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::Subnet"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">CidrBlock</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PublicSubnetCidr"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">AvailabilityZone</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"AvailabilityZone1"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"PUBLIC_SUBNET"</span></span></div><div class="line">          }</div><div class="line">        ],</div><div class="line">        "<span class="attribute">VpcId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PrivateSubnet</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::Subnet"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">CidrBlock</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PrivateSubnetCidr"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">AvailabilityZone</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"AvailabilityZone1"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"PRIVATE_SUBNET"</span></span></div><div class="line">          }</div><div class="line">        ],</div><div class="line">        "<span class="attribute">VpcId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">DefaultSecurityGroup</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::SecurityGroup"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">GroupDescription</span>": <span class="value"><span class="string">"Default Instance SecurityGroup"</span></span>,</div><div class="line">        "<span class="attribute">SecurityGroupIngress</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">IpProtocol</span>": <span class="value"><span class="string">"-1"</span></span>,</div><div class="line">            "<span class="attribute">CidrIp</span>": <span class="value">{</span></div><div class="line">              "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VpcCidr"</span></span></div><div class="line">            }</div><div class="line">          }</div><div class="line">        ],</div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"DEFAULT_SECURITY_GROUP"</span></span></div><div class="line">          }</div><div class="line">        ],</div><div class="line">        "<span class="attribute">VpcId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PublicRouteTable</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::RouteTable"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">VpcId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"PUBLIC_ROUTE_TABLE"</span></span></div><div class="line">          }</div><div class="line">        ]</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PublicRoute</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::Route"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">DestinationCidrBlock</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"AnyCidr"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">GatewayId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"InternetGateWay"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">RouteTableId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PublicRouteTable"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PublicSubnetRouteTableAssociation</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::SubnetRouteTableAssociation"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">RouteTableId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PublicRouteTable"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">SubnetId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PublicSubnet"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">NATEIP</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::EIP"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">InstanceId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"NATInstance"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">NATInstance</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::Instance"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">InstanceType</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"NATInstanceType"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">KeyName</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"KeyName"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">SubnetId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PublicSubnet"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">SourceDestCheck</span>": <span class="value"><span class="literal">false</span></span>,</div><div class="line">        "<span class="attribute">ImageId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Fn::FindInMap</span>": <span class="value">[</span></div><div class="line">            <span class="string">"AWSNATAMI"</span>,</div><div class="line">            {</div><div class="line">              "<span class="attribute">Ref</span>": <span class="value"><span class="string">"AWS::Region"</span></span></div><div class="line">            },</div><div class="line">            <span class="string">"AMI"</span></div><div class="line">          ]</div><div class="line">        },</div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"NAT"</span></span></div><div class="line">          }</div><div class="line">        ],</div><div class="line">        "<span class="attribute">SecurityGroupIds</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Ref</span>": <span class="value"><span class="string">"NATSecurityGroup"</span></span></div><div class="line">          }</div><div class="line">        ]</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PrivateSubnetRouteTable</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::RouteTable"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">VpcId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"PRIVATE_SUBNET_ROUTE_TABLE"</span></span></div><div class="line">          }</div><div class="line">        ]</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PrivateSubnetRoute</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::Route"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">DestinationCidrBlock</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"AnyCidr"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">InstanceId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"NATInstance"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">RouteTableId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PrivateSubnetRouteTable"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PrivateSubnetRouteTableAssociation</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::SubnetRouteTableAssociation"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">RouteTableId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PrivateSubnetRouteTable"</span></span></div><div class="line">        },</div><div class="line">        "<span class="attribute">SubnetId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PrivateSubnet"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">NATSecurityGroup</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Type</span>": <span class="value"><span class="string">"AWS::EC2::SecurityGroup"</span></span>,</div><div class="line">      "<span class="attribute">Properties</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">GroupDescription</span>": <span class="value"><span class="string">"NAT Instance SecurityGroup"</span></span>,</div><div class="line">        "<span class="attribute">SecurityGroupIngress</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">IpProtocol</span>": <span class="value"><span class="string">"-1"</span></span>,</div><div class="line">            "<span class="attribute">CidrIp</span>": <span class="value">{</span></div><div class="line">              "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VpcCidr"</span></span></div><div class="line">            }</div><div class="line">          }</div><div class="line">        ],</div><div class="line">        "<span class="attribute">Tags</span>": <span class="value">[</span></div><div class="line">          {</div><div class="line">            "<span class="attribute">Key</span>": <span class="value"><span class="string">"Name"</span></span>,</div><div class="line">            "<span class="attribute">Value</span>": <span class="value"><span class="string">"NAT_SECURITY_GROUP"</span></span></div><div class="line">          }</div><div class="line">        ],</div><div class="line">        "<span class="attribute">VpcId</span>": <span class="value">{</span></div><div class="line">          "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">        }</div><div class="line">      }</div><div class="line">    }</div><div class="line">  },</div><div class="line">  "<span class="attribute">Outputs</span>": <span class="value">{</span></div><div class="line">    "<span class="attribute">VPCId</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"VPC id"</span></span>,</div><div class="line">      "<span class="attribute">Value</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">Ref</span>": <span class="value"><span class="string">"VPC"</span></span></div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PublicSubnetId</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"public subnet id"</span></span>,</div><div class="line">      "<span class="attribute">Value</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PublicSubnet"</span></span></div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">PrivateSubnetId</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"private subnet id"</span></span>,</div><div class="line">      "<span class="attribute">Value</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">Ref</span>": <span class="value"><span class="string">"PrivateSubnet"</span></span></div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">NATSecurityGroupId</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"NAT SG id"</span></span>,</div><div class="line">      "<span class="attribute">Value</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">Ref</span>": <span class="value"><span class="string">"NATSecurityGroup"</span></span></div><div class="line">      }</div><div class="line">    },</div><div class="line">    "<span class="attribute">NATEIP</span>": <span class="value">{</span></div><div class="line">      "<span class="attribute">Description</span>": <span class="value"><span class="string">"NAT Server EIP."</span></span>,</div><div class="line">      "<span class="attribute">Value</span>": <span class="value">{</span></div><div class="line">        "<span class="attribute">Ref</span>": <span class="value"><span class="string">"NATEIP"</span></span></div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>你可以通过AWS提供的图形化界面AWS Management Console来使用该CloudFormation脚本，也可以通过AWS CLI来使用。使用以上的CloudFormation脚本创建的VPC可以一键创建你AWS中的基础网络架构。从此再也不用为配置网络发愁了。</p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/AWS/" class="post__tag__link">AWS</a></li><li class="post__tag__item"><a href="/tags/CloudFormation/" class="post__tag__link">CloudFormation</a></li><li class="post__tag__item"><a href="/tags/NAT/" class="post__tag__link">NAT</a></li></ul><a href="/2015/01/17/create-nat-node-in-aws/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><span class="post__time">黄博文</span><span class="post__time"> @ </span><time datetime="2014-10-22T12:33:42.000Z" class="post__time">October 22, 2014</time><h1 class="post__title"><a href="/2014/10/22/aws-cert-sample-question/">AWS助理架构师样题解析</a></h1></header><div class="post__main echo"><p>AWS 认证是对其在 AWS 平台上设计、部署和管理应用程序所需的技能和技术知识的一种认可。获得证书有助于证明您使用 AWS 的丰富经验和可信度，同时还能提升您所在的组织熟练使用基于 AWS 云服务应用的整体水平。</p>
<a id="more"></a>
<p>目前亚马逊推出了Solutions Architect,Developer和SysOps Administrator三个方向的认证。每个方向又分为Associate Level(助理级)，Professional Level（专家级）和Master Level（大师级）。当然目前只有Solutions Architect开放了Professional Level,其他层级会逐步开放中。</p>
<img src="/images/cert_roadmap_Q214_EN.png">

<p>最近在打算备考AWS的Solutions Architect的Associate Level。关于这个考试AWS出了一个考试样题。下载链接：<a href="http://awstrainingandcertification.s3.amazonaws.com/production/AWS_certified_solutions_architect_associate_blueprint.pdf" target="_blank" rel="external">http://awstrainingandcertification.s3.amazonaws.com/production/AWS_certified_solutions_architect_associate_blueprint.pdf</a></p>
<p>我把样题都做了一遍，并且都尽力找到了答案在AWS文档中的出处。以下是样题和解答。</p>
<p>Amazon Glacier is designed for: (Choose 2 answers)</p>
<p>A.active database storage.</p>
<p>B.infrequently accessed data.</p>
<p>C.data archives.</p>
<p>D.frequently accessed data.</p>
<p>E.cached session data.</p>
<p>答案：B和C</p>
<p>出处文档：<a href="http://aws.amazon.com/glacier/?nc2=h_ls" target="_blank" rel="external">http://aws.amazon.com/glacier/?nc2=h_ls</a></p>
<blockquote>
<blockquote>
<p>Amazon Glacier is an extremely low-cost cloud archive storage service that provides secure and durable storage for data archiving and online backup. In order to keep costs low, Amazon Glacier is optimized for data that is infrequently accessed and for which retrieval times of several hours are suitable.</p>
</blockquote>
</blockquote>
<p>Your web application front end consists of multiple EC2 instances behind an Elastic Load Balancer. You<br>configured ELB to perform health checks on these EC2 instances. If an instance fails to pass health<br>checks, which statement will be true?</p>
<p>A.The instance is replaced automatically by the ELB.</p>
<p>B.The instance gets terminated automatically by the ELB.</p>
<p>C.The ELB stops sending traffic to the instance that failed its health check. </p>
<p>D.The instance gets quarantined by the ELB for root cause analysis.</p>
<p>答案：C</p>
<p>出处文档：<a href="http://aws.amazon.com/elasticloadbalancing/?nc2=h_ls" target="_blank" rel="external">http://aws.amazon.com/elasticloadbalancing/?nc2=h_ls</a></p>
<blockquote>
<blockquote>
<p>Elastic Load Balancing ensures that only healthy Amazon EC2 instances receive traffic by detecting unhealthy instances and rerouting traffic across the remaining healthy instances.</p>
</blockquote>
</blockquote>
<p>You are building a system to distribute confidential training videos to employees. Using CloudFront, what<br>method could be used to serve content that is stored in S3, but not publically accessible from S3<br>directly?</p>
<p>A.Create an Origin Access Identity (OAI) for CloudFront and grant access to the objects in your S3<br>bucket to that OAI.</p>
<p>B.Add the CloudFront account security group “amazon-cf/amazon-cf-sg” to the appropriate S3 bucket<br>policy.</p>
<p>C.Create an Identity and Access Management (IAM) User for CloudFront and grant access to the<br>objects in your S3 bucket to that IAM User.</p>
<p>D.Create a S3 bucket policy that lists the CloudFront distribution ID as the Principal and the target<br>bucket as the Amazon Resource Name (ARN).</p>
<p>答案：A</p>
<p>OAI介绍：<a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html" target="_blank" rel="external">http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html</a></p>
<p>OAI基本上就是专为这个场景引入的。</p>
<p>Which of the following will occur when an EC2 instance in a VPC (Virtual Private Cloud) with an<br>associated Elastic IP is stopped and started? (Choose 2 answers)</p>
<p>A.The Elastic IP will be dissociated from the instance</p>
<p>B.All data on instance-store devices will be lost</p>
<p>C.All data on EBS (Elastic Block Store) devices will be lost</p>
<p>D.The ENI (Elastic Network Interface) is detached</p>
<p>E.The underlying host for the instance is changed</p>
<p>答案：B E</p>
<p>这个题难度比较高。可以用排除法，A，C，D肯定不能选，B是对的，那么剩下一个答案只有E了啊。</p>
<p>In the basic monitoring package for EC2, Amazon CloudWatch provides the following metrics:</p>
<p>A.web server visible metrics such as number failed transaction<br>requests</p>
<p>B.operating system visible metrics such as memory utilization</p>
<p>C.database visible metrics such as number of connections</p>
<p>D.hypervisor visible metrics such as CPU utilization</p>
<p>答案：D</p>
<p>注意题干说的是basic monitoring,A,B,C肯定不对。具体支持的监控指标可见<a href="http://docs.aws.amazon.com/zh_cn/AmazonCloudWatch/latest/DeveloperGuide/ec2-metricscollected.html#ec2-metrics" target="_blank" rel="external">http://docs.aws.amazon.com/zh_cn/AmazonCloudWatch/latest/DeveloperGuide/ec2-metricscollected.html#ec2-metrics</a>。D是唯一接近正确答案的，但是我对hypervisor了解不多，有些迷惑人。</p>
<p>Which is an operational process performed by AWS for data security?</p>
<p>A.AES-256 encryption of data stored on any shared storage device</p>
<p>B.Decommissioning of storage devices using industry-standard practices</p>
<p>C.Background virus scans of EBS volumes and EBS snapshots</p>
<p>D.Replication of data across multiple AWS Regions</p>
<p>E.Secure wiping of EBS data when an EBS volume is unmounted</p>
<p>答案：B</p>
<p>具体可以查看 was security whitepaper: <a href="https://media.amazonwebservices.com/pdf/AWS_Security_Whitepaper.pdf" target="_blank" rel="external">https://media.amazonwebservices.com/pdf/AWS_Security_Whitepaper.pdf</a></p>
<p>Storage Device Decommissioning 小节里面有这么一句话：</p>
<blockquote>
<blockquote>
<p>All decommissioned magnetic storage devices are<br>degaussed and physically destroyed in accordance with industry-standard practices.</p>
</blockquote>
</blockquote>
<p>To protect S3 data from both accidental deletion and accidental overwriting, you should:</p>
<p>A.enable S3 versioning on the bucket</p>
<p>B.access S3 data using only signed URLs </p>
<p>C.disable S3 delete using an IAM bucket policy </p>
<p>D.enable S3 Reduced Redundancy Storage</p>
<p>E.enable Multi-Factor Authentication (MFA) protected access</p>
<p>答案：A</p>
<p>出处文档:<a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/Versioning.html" target="_blank" rel="external">http://docs.aws.amazon.com/AmazonS3/latest/dev/Versioning.html</a></p>
<blockquote>
<blockquote>
<p>Versioning-enabled buckets enable you to recover objects from accidental deletion or overwrite. </p>
</blockquote>
</blockquote>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/AWS/" class="post__tag__link">AWS</a></li><li class="post__tag__item"><a href="/tags/Cloud/" class="post__tag__link">Cloud</a></li></ul><a href="/2014/10/22/aws-cert-sample-question/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2015 Cloud & DevOps小组</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><span title="Next" class="page-menu__link icon-arrow-right page-menu__link--disabled"></span></li></menu></footer></body></html>